# .github/workflows/deploy-s3.yml
name: Deploy Next.js Static Site to S3

on:
  push:
    branches:
      - main # main 브랜치에 푸시될 때 실행

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # 프로젝트에 맞는 Node.js 버전
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build Next.js static site
        run: npm run build # next.config.ts에 output: 'export' 설정이 되어 있어야 함

      - name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ap-northeast-2 # S3 버킷이 위치한 AWS 리전 (예: us-east-1, ap-northeast-2)

      - name: Deploy to S3
        run: aws s3 sync ./out s3://your-fitness-app-bucket-name --delete # your-fitness-app-bucket-name을 실제 버킷 이름으로 변경해주세요.
        # --delete 옵션은 S3 버킷에 없는 로컬 파일을 삭제하여 동기화 상태를 유지합니다.
